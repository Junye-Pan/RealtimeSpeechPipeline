# Deployment Scaffolds Guide

## Scope and Evidence

This guide documents the implemented MVP deployment scaffold baseline for `UB-S03`.

Primary evidence:
- `docs/PRD.md` sections `4.1.8`, `4.2`, `5.1`, and `5.2`.
- `docs/mvp_backlog.md` milestone `UB-S03`.
- Deploy scaffold contract checks in `test/contract/scaffold_artifacts_test.go`.
- Deterministic gate runner in `deploy/verification/gates/mvp_gate_runner.sh`.

## Implemented Scaffold Layout

```text
deploy/
  profiles/mvp-single-region/
  k8s/mvp-single-region/
  helm/rspp-mvp/
  terraform/mvp_single_region/
  verification/gates/
```

These paths include concrete artifacts used by the repo gates and release/tooling flows.

## Canonical MVP Deployment Artifacts

| Path | Purpose |
| --- | --- |
| `deploy/profiles/mvp-single-region/rollout.json` | Canonical deploy rollout profile linked to the MVP bundle ref. |
| `deploy/k8s/mvp-single-region/runtime-deployment.yaml` | MVP runtime Deployment manifest scaffold. |
| `deploy/k8s/mvp-single-region/control-plane-deployment.yaml` | MVP control-plane Deployment manifest scaffold. |
| `deploy/helm/rspp-mvp/Chart.yaml` | MVP Helm chart metadata. |
| `deploy/helm/rspp-mvp/values.yaml` | MVP Helm values for runtime/control-plane images and replicas. |
| `deploy/helm/rspp-mvp/templates/runtime-deployment.yaml` | Helm template for runtime Deployment. |
| `deploy/terraform/mvp_single_region/main.tf` | MVP Terraform scaffold entrypoint. |
| `deploy/terraform/mvp_single_region/variables.tf` | Terraform variable contract for MVP deploy profile wiring. |
| `deploy/verification/gates/mvp_gate_runner.sh` | Deterministic deploy verification runner chaining required gates. |

## Deterministic Gate Runner Contract

`deploy/verification/gates/mvp_gate_runner.sh` executes the deterministic MVP verification sequence:

1. `bash scripts/prepare-mvp-live-artifacts.sh`
2. `make verify-quick`
3. `make verify-full`
4. `make verify-mvp`
5. `make security-baseline-check`

The script is strict-shell (`set -euo pipefail`) and emits `mvp_gate_runner: PASS` on success.

## Linkage and Invariants

1. Deploy profile `bundle_ref` points to `pipelines/bundles/voice_assistant_bundle_v1.json`.
2. K8s/Helm/Terraform scaffolds remain aligned to the same `mvp-single-region` posture.
3. Deploy verification runner uses repository gate commands directly rather than duplicating gate logic.
4. Gate artifacts generated by the runner are the same artifacts consumed by release and feature-status governance.

## Validation Commands

Run from repository root:

```bash
go test ./test/contract -run 'TestGateScriptsAreExecutable|TestMVPGateRunnerScriptHasDeterministicExecutionOrder|TestDeployScaffoldTemplatesContainExpectedBaselineMarkers'
bash deploy/verification/gates/mvp_gate_runner.sh
```

## Post-MVP Expansion Surface

The following scaffold areas remain open for later expansion while preserving MVP baseline behavior:

- Multi-region deploy profiles.
- Additional Helm charts and values overlays.
- Terraform module split for network/cluster/security/state.
- Additional deploy smoke suites under `deploy/verification/smoke`.
